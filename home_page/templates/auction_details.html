{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Auction Details</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/auction_details.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/font.css' %}">
</head>
<body>
    {% if error_message %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ error_message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    {% if success_message %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ success_message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <p><a href="{% url 'home_page' %}"> &lt; Back</a></p>
    <img src="{{ auction.picture1.url }}" alt="Item Picture 1" class="item-pic">
    <h1>{{ auction.item_name }}</h1>
    <p>Description: {{ auction.item_desc }}</p>
    <p>Category: {{ auction.item_cat }}</p>
    <p>Auction Time Left: <span id="countdown"></span></p>
    <p>Auction End Time: {{ auction.auction_end_time }}</p>
    <p>Starting Bid: RM{{ auction.start_bid }}</p>
    <p>Current Bid: RM{{ auction.current_bid }}</p>
    <form method="post" action="{% url 'place_bid' auction.id %}">
        {% csrf_token %}
        <input type="number" name="bid_amount" step="0.01" min="{{ auction.current_bid }}" placeholder="Enter your bid">
        <button type="submit">Place Bid</button>
    </form>
    <p>Seller: {{ seller_username }}</p>

    <script>
        // Function to calculate and update the countdown timer
        function updateCountdown(endTime) {
            // Get the current time
            var now = new Date().getTime();

            // Calculate the time difference between now and the end time
            var timeDifference = endTime - now;

            // Check if the auction has ended
            if (timeDifference <= 0) {
                document.getElementById("countdown").innerHTML = "Auction ended";
                return;
            }

            // Calculate days, hours, minutes, and seconds
            var days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
            var hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

            // Format the time remaining
            var countdown = "";
            if (days > 0) {
                countdown += days + " day ";
            }
            if (hours > 0) {
                countdown += hours + " hr ";
            }
            if (minutes > 0) {
                countdown += minutes + " min ";
            }
            countdown += seconds + " sec";

            // Update the countdown timer display
            document.getElementById("countdown").innerHTML = countdown;

            // Update the countdown every second
            setTimeout(function() {
                updateCountdown(endTime);
            }, 1000);
        }

        // Parse the auction end time from Django template to JavaScript Date object
        var auctionEndTime = new Date("{{ auction.auction_end_time|date:'Y-m-d H:i:s' }}").getTime();
        
        // Call the function to initialize the countdown timer
        updateCountdown(auctionEndTime);
    </script>
</body>
</html>
